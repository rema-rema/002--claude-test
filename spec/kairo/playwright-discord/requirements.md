# Playwright Discord通知システム - 要件定義書

## プロジェクト概要

**機能名:** Playwright Discord通知システム  
**目的:** Playwrightテスト実行完了時にDiscordへ自動通知し、テスト結果詳細を確認できるシステムと容量管理機能の提供  
**作成日:** 2025-08-24  

## 1. 基本要件

### 1.1 Discord通知機能
**機能ID:** REQ-001  
**概要:** Playwrightテスト実行完了時の自動Discord通知  

- **トリガー**: Playwrightテスト実行完了時（成功・失敗問わず）
- **通知先**: 指定Discordチャンネル（既存設定を活用）
- **通知内容**:
  - テスト実行サマリー（成功件数/失敗件数/実行時間）
  - テスト実行時刻
  - 実行環境情報（ブラウザ、OS等）
  - 詳細情報への導線

### 1.2 詳細情報アクセス機能
**機能ID:** REQ-002  
**概要:** Discord通知から詳細テスト結果への簡単アクセス  

- **アクセス方法**: Discord通知メッセージから詳細確認可能
- **提供情報**:
  - テスト概要（実行されたテストケース一覧）
  - テスト仕様書確認リンク
  - テスト結果詳細（各テストケースの成功/失敗）
  - 失敗時スクリーンショット（Discord添付または表示）
  - 失敗時動画ファイル（ダウンロードリンクまたは添付）

## 2. 容量管理機能

### 2.1 容量監視バッチ
**機能ID:** REQ-003  
**概要:** テスト結果ファイルの容量監視と手動管理支援  

- **対象ディレクトリ**: `test-results/`フォルダ
- **監視条件**: 1GB超過時にアラート表示
- **実行方式**: 手動実行可能なスクリプト
- **出力情報**:
  - 現在の使用容量（MB/GB単位）
  - ファイル一覧（作成日時順、サイズ付き）
  - 容量超過状況の可視化

### 2.2 手動管理支援機能
**機能ID:** REQ-004  
**概要:** 容量超過時の削除判断支援  

- **目的**: 容量超過時のユーザー判断支援
- **機能**: 削除対象ファイル候補の推奨表示
- **操作方式**: 手動削除（自動削除は監査要件により禁止）
- **推奨ロジック**: 古いファイル、大きなファイルを優先表示

## 3. 技術制約・非機能要件

### 3.1 既存システム連携
- **Discord Bot**: 既存`DiscordBot`クラス活用（discord-bot/src/discord-bot.js）
- **Playwright**: 既存`playwright.config.js`設定維持
- **影響度制約**: 既存システムの動作に一切影響を与えない

### 3.2 環境制約
- **実行環境**: GitHub Codespaces
- **Node.js**: v18.20.8対応
- **ファイルサイズ制限**: Discord添付ファイル25MB以下
- **レスポンス要件**: 通知送信は5秒以内

### 3.3 セキュリティ・監査要件
- **自動削除禁止**: 監査トレーサビリティのため自動削除は実装しない
- **手動承認**: 重要な操作は手動実行・手動承認とする
- **ログ保持**: 通知送信ログを保持する

## 4. 成功基準

### 4.1 機能要件の成功基準
- [ ] テスト完了時のDiscord通知が100%確実に届く
- [ ] 通知から詳細情報に3クリック以内でアクセスできる
- [ ] 容量監視バッチが正確な情報を表示する
- [ ] スクリーンショット・動画が正常に表示・アクセスできる

### 4.2 非機能要件の成功基準
- [ ] 既存システムに影響を与えない（回帰テスト通過）
- [ ] 通知送信が5秒以内に完了する
- [ ] 25MB以下のファイルが正常に添付される
- [ ] エラー発生時も既存機能が継続動作する

## 5. 除外事項

- 自動削除機能（監査要件により除外）
- リアルタイム通知（テスト完了時のみ）
- 他チャット系サービス対応（Discordのみ）
- 詳細分析機能（基本情報表示のみ）

## 6. 今後の拡張可能性

- 通知のカスタマイズ設定
- 複数チャンネル対応
- テスト結果の統計レポート機能
- クラウドストレージ連携（将来的な容量対策）